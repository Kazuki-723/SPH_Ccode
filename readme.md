# SPH Simulation

粒子法（Smoothed Particle Hydrodynamics）を用いて流体挙動を解析するためのシミュレーションコードです。  
中央に仕切り壁と穴を設置し、流体が穴から流れ出す様子を可視化します。

---

## ダウンロード

このリポジトリに含まれるコードだけで基本動作します。

- ルート直下のファイル  
  C 言語だけで完結するシングルファイル版  
- cppfiles/ ディレクトリ  
  SPH コア機能を C++ モジュール化し、`main.c` でシミュレーション条件を指定する構成  

---


## 必要環境

- C コンパイラ（例：gcc）  
- C++ コンパイラ（例：g++）  
- OpenMP（並列処理用）  
- FFmpeg（PPM→GIF 生成用）  
- POSIX 系 OS または Windows（ディレクトリ作成マクロ対応）  

---

## ビルドと実行

### C シングルファイル版

```bash
gcc -O3 -fopenmp SPH_c_code2_x-sph.c -lm -o sph_sim
./sph_sim
```

### C シングルファイル版

```bash
cd cppfiles
g++ -O3 -fopenmp -c sph.cpp -o sph.o
cd ..
gcc -O3 -fopenmp main.c cppfiles/sph.o -lm -o sph_mod
./sph_mod
```

一時データを保存するための`temp/`が生成され, 最終結果がgihとして出力されます.

---
## 実行上の注意

- `temp/` 内に大量の PPM ファイルが生成されます。数万ステップ実行すると 1 GB を超える場合があります。
- サンプル設定（1000～10000 ステップ）で数分～20 分前後かかります。進捗を確認しながら実行してください。
- 不要になったら `temp/` フォルダを削除して構いません。

---
## 設定可能なパラメータ

`main.c` またはシングルファイルの先頭で以下の定数を調整できます。

| 定数                  | 説明                                | デフォルト     |
|---------------------|-----------------------------------|------------|
| `ps`                | 粒子間隔 [m]                         | 0.001      |
| `dt`                | タイムステップ [s]                   | 1e-4       |
| `steps`             | 総ステップ数                          | 1000       |
| `step_per_frame`    | フレーム出力間隔                      | 10         |
| `rho0`              | 流体密度 [kg/m³]                     | 1000.0     |
| `k`                 | 圧力定数                              | 100.0      |
| `visc`              | 粘性係数                              | 10.0       |
| `gacc`              | 重力加速度 [m/s²]                     | 9.8        |
| `eps`               | 計算用微小値（ゼロ除算防止）            | 1e-6       |

---
## 開発者向けメモ

- 境界粒子（バウンダリー）の C++ 実装  
- 物理パラメータ（粘度・音速）の適切化  
- PPM 生成を不要にするリアルタイム GIF 化バージョンの作成  
- SPH 本体の安定化・最適化  
